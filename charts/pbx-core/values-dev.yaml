# =====================================================
# PBX CORE - Development/Local Values File
# Single-instance, minimal resources for local dev
# =====================================================

global:
  security:
    allowInsecureImages: true  # Allow for faster local dev

# -----------------------------------------------------
# PBX CORE - SINGLE INSTANCE
# -----------------------------------------------------
replicaCount: 1

image:
  repository: akashtripathi/pbx-core
  tag: "latest"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 9080

# Keep Istio enabled for local dev
istio:
  enabled: true
  gateway: "front-dev/platform-ui-gateway"
  host: "api.platform-dev.dalaillama.com"

# Disable HPA - single replica
autoscaling:
  enabled: false

# -----------------------------------------------------
# PROBES - More lenient for local dev
# -----------------------------------------------------
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 9080
  initialDelaySeconds: 60
  periodSeconds: 30
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 9080
  initialDelaySeconds: 30
  periodSeconds: 15
  failureThreshold: 5

# -----------------------------------------------------
# MINIMAL RESOURCES
# -----------------------------------------------------
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 1Gi

# Disable PDB for local dev
podDisruptionBudget:
  enabled: false

# Keep subcharts enabled
subcharts:
  mysql:
    enabled: true
  redis:
    enabled: true
  kafka:
    enabled: true

# =====================================================
# MYSQL - STANDALONE, NO REPLICATION
# =====================================================
mysql:
  enabled: true
  
  image:
    repository: mysql
    tag: "8.0"
    pullPolicy: IfNotPresent

  # Use simple credentials for local dev
  existingSecret: ""
  
  auth:
    rootPassword: "root123"
    user: "pbx_user"
    password: "pbx123"
    database: "pbx_core_db"

  # DISABLE REPLICATION
  replication:
    enabled: false

  # Minimal storage
  persistence:
    size: 1Gi
    storageClass: ""

  # Minimal resources
  resources:
    primary:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

  # Disable PDB
  podDisruptionBudget:
    enabled: false

# =====================================================
# REDIS - STANDALONE, NO REPLICAS
# =====================================================
redis:
  image:
    repository: redis
    tag: "7.2"
    pullPolicy: IfNotPresent

  # SINGLE INSTANCE
  replicaCount: 1

  # Minimal storage
  persistence:
    size: 500Mi
    storageClass: ""

  # Minimal resources
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# =====================================================
# KAFKA - SINGLE NODE (MINIMAL KRaft)
# =====================================================
kafka:
  image:
    repository: apache/kafka
    tag: "3.7.0"
    pullPolicy: IfNotPresent

  # SINGLE BROKER
  replicaCount: 1

  # Minimal storage
  persistence:
    size: 1Gi
    storageClass: ""

  # Minimal resources
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  kraft:
    enabled: true
    clusterId: "dev-local-cluster"

# -----------------------------------------------------
# DISABLE MONITORING FOR LOCAL DEV
# -----------------------------------------------------
prometheus:
  enabled: false

backup:
  mysql:
    enabled: false
  kafka:
    enabled: false

# -----------------------------------------------------
# MINIMAL CONFIG
# -----------------------------------------------------
podAnnotations: {}

networkPolicy:
  enabled: false

serviceAccount:
  create: true
  name: ""
  annotations: {}

ingress:
  enabled: false